<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>NDIS Australia - Interactive Narrative</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>

  <style>
    /*Page structure and typography*/
    * {
      box-sizing: border-box; /* Consistent sizing across all elements */
    }

    html {
      scroll-behavior: smooth;
    }

    /* enables smooth scrolling for anchor links */
    body {
      margin: 0;
      /*sans-serif stack */
      font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
      font-size: 14px;
      /* optimal reading size */
      background: #f9f6ef;
      color: #222;
    }

    /* Sticky header for context and navigation */
    header {
      position: sticky;
      top: 0;
      z-index: 30;
      background: #f9f6ef;
      border-bottom: 1px solid #ddd;
      padding: 10px 20px 8px;
      font-weight: 600;
    }

    /* Section base style */
    section {
      background: #f9f6ef;
      position: relative;
    }
    /* Reveal animation for scroll-based appearance */
    .reveal {
      opacity: 0;
      transform: translateY(40px);
      transition: .8s;
    }

    .reveal.visible {
      opacity: 1;
      transform: none;
    }
    /* Headings - consistent margin and bold weight */
    h1,
    h2,
    h3 {
      margin: 0;
      font-weight: 600;
    }

    /* Line chart toggle buttons */
    .lineBtn {
      margin: 0 4px;
      padding: 4px 10px;
      font-size: 12px;
      border: 1px solid #888;
      border-radius: 4px;
      background: #eee;
      cursor: pointer;
    }

    /* Active state for selected line chart toggle */
    .lineBtn.active {
      background: #0066cc;
      color: #fff;
      border-color: #0066cc;
    }

    /* ==== MODAL STYLES ==== */
    /* Main modal container - full screen overlay, centered content */
    #storyModal {
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100vw;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(30, 32, 39, 0.44);
      /* transparent dark overlay */
      transition: opacity .3s;
    }

    /* Hidden state for modal (used for smooth closing) */
    #storyModal.hide {
      opacity: 0;
      pointer-events: none;
    }

    /* Background blur layer behind modal card */
    .storyModal-bg {
      position: absolute;
      left: 0;
      top: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.22);
      /* subtle blur */
      z-index: 1;
    }

    /* Modal content card */
    .storyModal-card {
      position: relative;
      z-index: 2;
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 6px 48px rgba(0, 0, 0, 0.17);
      max-width: 410px;
      width: 92vw;
      padding: 34px 32px 28px 32px;
      text-align: left;
      font-size: 16px;
      line-height: 1.45;
      color: #222;
      animation: pop .42s cubic-bezier(.48, 1.6, .68, .98);
    }

    /* Modal heading style */
    .storyModal-card h2 {
      margin-top: 0;
      font-size: 1.7em;
      font-weight: 700;
      margin-bottom: 14px;
    }

    .storyModal-card ul {
      padding-left: 20px;
      margin: 12px 0 16px 0;
    }

    .storyModal-card li {
      margin-bottom: 3px;
    }

    /* Primary button inside modal */
    .storyModal-btn {
      background: #0066cc;
      color: #fff;
      border: none;
      border-radius: 24px;
      font-size: 15px;
      padding: 9px 26px;
      margin-top: 16px;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0, 0, 0, .06);
      font-weight: 600;
    }

    /* Button hover effect */
    .storyModal-btn:hover {
      background: #0051a5;
    }
    /* Modal close button */
    .storyModal-close {
      position: absolute;
      right: 18px;
      top: 14px;
      background: none;
      border: none;
      font-size: 2.1em;
      color: #888;
      cursor: pointer;
      padding: 0;
      line-height: 1;
    }

    .storyModal-close:hover {
      color: #0066cc;
    }

    /* INTRO */
    #intro {
      height: 88vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      gap: 18px;
    }

    #intro h1 {
      font-size: clamp(32px, 6vw, 48px);
    }

    /* main headline size (responsive) */
    #startBtn {
      margin-top: 10px;
      padding: 10px 22px;
      border: 0;
      border-radius: 30px;
      font-size: 16px;
      cursor: pointer;
      background: #0066cc;
      color: #fff;
    }

    /* Start button hover state */
    #startBtn:hover {
      background: #004d99;
    }
    /* Floating story narration box */
    #storyBox {
      position: fixed;
      top: 110px;
      left: 24px;
      width: 250px;
      background: #ffffffee;
      border: 1px solid #bbb;
      border-radius: 6px;
      padding: 14px;
      line-height: 1.4;
      box-shadow: 0 2px 6px rgba(0, 0, 0, .12);
      z-index: 50;
    }

    /* MAP */
    #sec-map {
      padding: 0 0 24px;
      border-top: 1px solid #ddd;
    }

    #map {
      display: block;
      width: 100%;
      height: auto;
    }
    /* Base path styling for map regions */
    path.state {
      stroke: #333;
      stroke-width: .5;
      pointer-events: all;
      transition: filter .3s;
    }

    /* Hover interaction for regions */
    path.state:hover {
      stroke: #000;
      stroke-width: 1.5;
      fill-opacity: .9;
      cursor: pointer;
    }

    path.state.active {
      /* keeps the clicked state lit */
      stroke: #ff7f0e;
      stroke-width: 2.5;
    }

    /* Legend container for map color scale */
    #mapLegend {
      position: absolute;
      bottom: 18px;
      left: 18px;
      background: #f9f6ef;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 6px 10px;
      font-size: 11px;
      box-shadow: 0 1px 4px rgba(0, 0, 0, .12);
    }

    #legendGrad {
      width: 140px;
      height: 10px;
      margin: 4px 0;
    }
    /* Pulse animation */
    @keyframes pulseFaint {
      0% {
        opacity: .25;
      }

      50% {
        opacity: 1;
      }

      100% {
        opacity: .25;
      }
    }
    /* Nudging for prompting interaction */
    #nudgeMap {
      position: absolute;
      top: 12px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 22px;
      color: #333;
      pointer-events: none;
      animation: pulseFaint 2s infinite;
    }

    /* DONUT  */
    #sec-donut {
      display: flex;
      flex-direction: column;
      /* Stack content vertically */
      align-items: center;
      padding: 50px 0;
      border-top: 1px solid #ddd;
    }

    /* Dropdown to select state for donut chart */
    #stateSelect {
      margin-bottom: 12px;
      padding: 4px 6px;
      font-size: 14px;
    }

    /* Donut Chart Container Box */
    #donutWrap {
      width: 420px;
      background: #f9f6ef;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, .15);
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    #donut {
      width: 380px;
      height: 380px;
    }
    /* Toggle to switch */
    #toggleBtn {
      margin-top: 8px;
      font-size: 11px;
      padding: 4px 8px;
      cursor: pointer;
      border: 1px solid #888;
      border-radius: 4px;
      background: #f0f0f0;
    }

    /*Legend Grid (below the donut chart) */
    #legend {
      font-size: 11px;
      margin-top: 10px;
      display: grid;
      grid-template-columns: repeat(2, auto);
      gap: 2px 6px;
      max-height: 160px;
      overflow: auto;
    }

    .swatch {
      display: inline-block;
      width: 12px;
      height: 12px;
      border: 1px solid#000;
      margin-right: 4px;
    }
    /* doinut bounce feature */
    @keyframes donutBounce {
      0% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.05);
      }

      100% {
        transform: scale(1);
      }
    }

    #donutWrap.pulse {
      animation: donutBounce 1.5s infinite;
    }

    /* TOOLTIP  */
    .tooltip {
      position: absolute;
      pointer-events: none;
      font-size: 13px;
      opacity: 0;
      background: #fff;
      padding: 8px;
      border: 1px solid #999;
      border-radius: 4px;
      box-shadow: 2px 2px 6px rgba(0, 0, 0, .15);
      z-index: 100;
    }

    /* CHART SECTIONS */
    .chartSec {
      padding: 60px 0;  /* Vertical spacing between visual blocks */
      border-top: 1px solid #ddd;
    }
    /* Generic chart container elements */
    #lineChart,
    #dotPlot,
    #stackChart {
      display: block;
      margin: 0 auto;  /* Center charts horizontally */
    }
    /* Line chart path */
    .trend {
      fill: none;
      stroke-width: 2.5;
    }

    .trend.faded {
      opacity: .15;
    }
    /* Year slider */
    #sliderWrap {
      display: flex;
      align-items: center;
      gap: 10px;
      justify-content: center;
      margin-bottom: 12px;
    }

    #yearSlider {
      width: 320px;
    }
    /* Axis styling */
    .axisLabel {
      font-size: 11px;
      fill: #444;
      text-anchor: middle;
    }

    /* bold axes everywhere */
    .xAxis text,
    .yAxis text {
      font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
      font-size: 14px;
      font-weight: 700;
      /* bold ticks */
    }

    .axisLabel {
      /* X/Y titles */
      font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
      font-size: 14px;
      font-weight: 700;
      fill: #222;
      text-anchor: middle;
    }

    .xAxis path,
    .xAxis line,
    .yAxis path,
    .yAxis line {
      stroke: #222;
      /* dark lines  */
      stroke-width: 1.2px;
      /* thick lines */
    }

    /* TIP BOXES */
    /* "Pop" animation for tip box appearance */
    @keyframes pop {
      0% {
        transform: scale(.8);
        opacity: 0;
      }

      100% {
        transform: scale(1);
        opacity: 1;
      }
    }
    /* Tip box container (appears beside charts to explain insights) */
    .tipBox {
      position: absolute;
      right: 14px;
      top: 14px;
      max-width: 240px;
      font-size: 14px;
      line-height: 1.35;
      background: #fff;
      border: 2px solid #0066cc;
      border-radius: 8px;
      padding: 10px 14px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, .15);
      cursor: pointer;
      z-index: 60;
      animation: pop .4s ease-out both;
    }
    .tipBox strong {
      color: #0066cc;
    }
  </style>
</head>

<body>

  <!-- STORY MODAL -->
  <div id="storyModal" style="display:flex;">
    <div class="storyModal-bg"></div>
    <div class="storyModal-card">
      <button class="storyModal-close" aria-label="Close modal">&times;</button>
      <h2>Welcome to the NDIS exploration Landscape!</h2>
      <!-- Introductory paragraph with step-by-step visual guide -->
      <p>
        This interactive story guides you through how NDIS services are distributed across Australia.<br>
      <ul>
        <li><b>Start with the map</b> to see budget patterns at a glance.</li>
        <li><b>Explore the donut chart</b> for participant demographics by disability and age.</li>
        <li><b>Trace trends over time</b> by disability type in the line chart.</li>
        <li><b>Dive into age groups and regions</b> with the dot and bar charts for detailed comparisons.</li>
      </ul>
      Every step is interactive-hover, click, and filter to discover patterns and insights.
      </p>
      <!-- Call-to-action button to close modal and begin the experience -->
      <button class="storyModal-btn" id="storyModal-ok">Get started</button>
    </div>
  </div>

  <!-- ---Sticky Header Title -- -->
  <header>NDIS Data - Australia's National Disability Insurance Scheme</header>

  <!-- --- INTRO --- -->
  <section id="intro" class="reveal">
    <h1>Exploring NDIS Support Across Australia</h1> <!-- Main title of the interactive dashboard -->
    <p>Follow the guided story or jump straight in.</p>
    <p><strong>Created by Mubrooka Abbasi</strong></p>
    <button id="startBtn">Start exploring↓</button>
  </section>

  <!-- --- MAP --- -->
  <section id="sec-map" class="reveal">
    <!-- Contextual tooltip encouraging users to begin with the map -->
    <div class="tipBox" id="tip-map"><strong>Start here:</strong><br>Hover any state for details, then <em>click</em> to
      update all charts.</div>

    <h2 style="text-align:center;margin:14px 0 6px;">Budget (AUD) distribution across regions</h2>
    <svg id="map" class="glow" viewBox="0 0 1000 600" preserveAspectRatio="xMidYMid meet"></svg>
    <!-- Map legend with dynamic gradient and budget labels -->
    <div id="mapLegend"><strong>Budget (AUD)</strong><br>
      <div id="legendGrad"></div><span style="float:left">$low</span><span style="float:right">$high</span>
    </div>
  </section>
  <!-- Map interpretation paragraph with insight commentary -->
  <p class="reveal" style="max-width:750px;margin:0 auto 60px;font-size:15px;line-height:1.45;">
    <strong>Map insight:</strong> The map shows the Northern Territory and other sparsely populated states hand out the
    largest average budgets per participant, while the big states allocate less budget per participant.<br><em>So
      what?</em> This reveals geographic equity issues—try clicking other states to compare.
  </p>

  <!-- --- DONUT --- -->
  <section id="sec-donut" class="reveal">
    <div class="tipBox" id="tip-donut"><strong>Explore participants:</strong><br>Pick a state, then toggle between
      disability and age slices. Click a slice to filter other charts.</div>

    <h2 style="text-align:center;margin-bottom:10px;">Participant share by disability / age</h2>
    <!-- Dropdown menu to select state -->
    <select id="stateSelect"></select>
    <div id="donutWrap" class="pulse">
      <svg id="donut"></svg>
      <button id="toggleBtn">show: age-band</button>
      <div id="legend"></div>
    </div>
  </section>
  <!-- Donut interpretation and insight narrative -->
  <p class="reveal" style="max-width:750px;margin:0 auto 60px;font-size:15px;line-height:1.45;">
    <strong>Donut insight.</strong> No matter which state you pick, Autism forms the biggest slice of the participant
    pie. Flip the toggle to "age-band" and you'll see a twin focus on early and later life (0-14 and 55+).<br><em>Next
      step:</em> Click a donut slice to filter the rest of the charts.
  </p>

  <!-- --- LINE -->
  <section id="sec-line" class="chartSec reveal">
    <div class="tipBox" id="tip-line"><strong>Trend view:</strong><br>Drag the slider or hover a line.<br>Unselect the
      donut chart to show all disabilities</div>

    <!-- Toggle buttons: switch between top 5 and all disabilities -->
    <h2 style="text-align:center;margin-bottom:14px;">Budget trends across disability</h2>
    <div id="lineBtns" style="text-align:center;margin-bottom:6px;">
      <button id="btnTop" class="lineBtn active">Top 5</button>
      <button id="btnAll" class="lineBtn">All disabilities</button>
    </div>

    <!-- Slider control to filter by quarter -->
    <div id="sliderWrap">
      <label for="yearSlider" style="font-size:13px">Quarter:</label>
      <input id="yearSlider" type="range" min="0" step="1">
      <span id="sliderLabel" style="font-size:13px"></span>
      <datalist id="sliderMarks"></datalist>
    </div>
    <svg id="lineChart" width="950" height="420"></svg>
  </section>
  <p class="reveal" style="max-width:750px;margin:0 auto 60px;font-size:15px;line-height:1.45;">
    <strong>Line insight.</strong> We can see two stand-outs: Spinal Cord Injury and ABI receive the highest average
    budgets in every quarter. All groups trend upward, but these two keep their lead.<br><em>So what?</em> Use the
    Top-5/All toggle and slider to focus on specific disabilities.


    <!-- ==== DOT ==== -->
  <section id="sec-dot" class="chartSec reveal">
    <div class="tipBox" id="tip-dot"><strong>Regional focus:</strong><br>Select a state to compare age-group budgets.
    </div>

    <!-- Section heading for the dot plot -->
    <h2 style="text-align:center;margin-bottom:10px;">Regional budget per age group</h2>
     <!-- Dropdown to select a state or region -->
    <select id="regionSelect" style="margin:0 auto 12px;display:block;font-size:14px;"></select>
    <h3 style="text-align:center;margin-bottom:12px;">Budget by age bucket &amp; region (<span id="dotTitle">ACT</span>)
    </h3>
    <svg id="dotPlot" width="950" height="500"></svg>
  </section>
  <!-- Insight paragraph explaining key takeaway from dot plot -->
  <p class="reveal" style="max-width:750px;margin:0 auto 60px;font-size:15px;line-height:1.45;">
    <strong>Dot-plot insight:</strong> The older age groups (25-34 and 35-54) stack highest on the y-axis, showing these
    age groups have highest funding.<br><em>Next step:</em> Select a region or click age groups in donut to see patterns
    shift in the plot.
  </p>

  <!-- ==== STACK ==== -->
  <section id="sec-stack" class="chartSec reveal">
    <!-- Tooltip box offering guidance and tips for using the chart -->
    <div class="tipBox" id="tip-stack">
      <strong>Age dynamics:</strong><br>
      Click an age slice in the donut to highlight it here.<br>
      &bull;Hover to reveal info <br>
      &bull;Toggle to grouped bar chart to compare budget across age groups more clearly
    </div>
     <!-- Main heading for this chart section -->
    <h2 style="text-align:center;margin-bottom:12px;">Budget trends across age groups</h2>

    <!-- Button to toggle between stacked and grouped bar chart views -->
    <button id="stackToggle" style="margin:0 auto 6px;display:block;font-size:12px">
      view: stacked
    </button>
    <svg id="stackChart" width="950" height="420"></svg>
  </section>
<!-- Supporting insight paragraph to guide user interpretation of the chart -->
  <p class="reveal" style="max-width:750px;margin:0 auto 60px;font-size:15px;line-height:1.45;">
    <strong>Stack insight:</strong> Here we can see the budget trend for age brackets for each quarter. Overall, the
    budget has been rising steadily with the highest allocations to 25-54 age groups.<br><em>So what?</em> Toggle to
    grouped chart for deeper analysis of growing trends and comparisons.
  </p>

  <!-- shared tooltip -->
  <div class="tooltip"></div>

  <script>
    /*  GLOBAL HELPERS */

    /* Global application state used across charts */
    const app = { state: "ACT", mode: "disability", focus: null, ageFilter: null };

    /* Mapping full state names and abbreviations to official short codes */
    const nameToCode = {
      "Australian Capital Territory": "ACT", ACT: "ACT",
      "New South Wales": "NSW", NSW: "NSW",
      "Victoria": "VIC", VIC: "VIC",
      "Queensland": "QLD", QLD: "QLD",
      "South Australia": "SA", SA: "SA",
      "Western Australia": "WA", WA: "WA",
      "Tasmania": "TAS", TAS: "TAS",
      "Northern Territory": "NT", NT: "NT"
    };
    const codeToName = Object.fromEntries(
      Object.entries(nameToCode).map(([k, v]) => [v, k]));
    /* Age group categories used across donut, dot, and stack charts */
    const ageBuckets = ["0-14", "15-24", "25-34", "35-54", "55+"];
    const ageColor = d3.scaleOrdinal(ageBuckets, d3.schemeSet3);

    /* Colour scale for disability */
    const disColour = d3.scaleOrdinal()
      .range([...d3.schemeTableau10, ...d3.schemeSet3,
      ...d3.schemePaired, ...d3.schemePastel1]);
    function disabilityColor(d) { return disColour(d); }

    const regionColor = d3.scaleOrdinal(d3.schemeTableau10);
    const tooltip = d3.select(".tooltip");

    const fmtQuarter = d => `Q${Math.floor(d.getMonth() / 3) + 1}-${d.getFullYear()}`;
    const fmtQuarterFull = d => `Q${Math.floor(d.getMonth() / 3) + 1}-${d.getFullYear()}`;

    /* tip boxes close on click */
    document.querySelectorAll(".tipBox").forEach(b => b.addEventListener("click", () => b.remove()));

    /* reveal on scroll */
    document.querySelectorAll(".reveal").forEach(el => new IntersectionObserver(e => e.forEach(f => f.isIntersecting && f.target.classList.add("visible")), { threshold: .1 }).observe(el));

    /* intro scroll */
    document.getElementById("startBtn").onclick = () => document.getElementById("sec-map").scrollIntoView({ behavior: "smooth" });

    /*  MAP  */
    let mapClicked = false; const svg = d3.select("#map"), geoPath = d3.geoPath(); let mapColor;

    // Load GeoJSON data containing average budget per state
    d3.json("ndis_by_state.geojson").then(geo => {
      geoPath.projection(d3.geoIdentity().fitSize([1000, 600], geo));
      mapColor = d3.scaleSequential(d3.extent(geo.features, d => +d.properties.avg_budget), d3.interpolateBlues);
      // Format and display the min and max values of the legend scale
      document.getElementById("legendGrad").style.background = `linear-gradient(to right,${mapColor.range().join(",")})`;
      d3.select("#mapLegend span:first-of-type").text("$" + d3.format(".2s")(mapColor.domain()[0]));
      d3.select("#mapLegend span:last-of-type").text("$" + d3.format(".2s")(mapColor.domain()[1]));
      // Draw each state as a <path> in the SVG
      svg.selectAll("path").data(geo.features).enter().append("path").attr("class", "state")
        .attr("d", geoPath).attr("fill", d => mapColor(+d.properties.avg_budget))
        // === Tooltip on hover ===
        .on("mouseover", (e, d) => tooltip.html(`<strong>${d.properties.STE_NAME21}</strong><br>Budget $${d3.format(",.0f")(d.properties.avg_budget)}<br>Participants ${d3.format(",")(d.properties.participant_count)}`)
          .style("left", (e.pageX + 12) + "px").style("top", (e.pageY - 28) + "px").style("opacity", 1))
        .on("mousemove", e => tooltip.style("left", (e.pageX + 12) + "px").style("top", (e.pageY - 28) + "px"))
        .on("mouseout", () => tooltip.style("opacity", 0))

        .on("click", function (_, d) {

          /* setting highlight */
          svg.selectAll("path.state").classed("active", false);
          d3.select(this).classed("active", true);
          // Update global state and refresh all charts
          app.state = nameToCode[d.properties.STE_NAME21];
          stateChanged();
        });

      /* dropdown */
      const sel = document.getElementById("stateSelect");
      Object.keys(codeToName).forEach(cd => { const o = document.createElement("option"); o.value = cd; o.textContent = codeToName[cd]; sel.appendChild(o); });
      sel.value = "ACT"; sel.onchange = () => { app.state = sel.value; stateChanged(); document.getElementById("tip-donut")?.remove(); };

      stateChanged();
    });

    /*  DONUT  */
    // Load CSV 
    let donutRows, donutBounce = true;
    d3.csv("donut_age_disability.csv", d3.autoType).then(r => { donutRows = r; drawDonut(); });

    /* Toggle between "disability" and "age-band" views */
    document.getElementById("toggleBtn").onclick = () => {
      document.getElementById("tip-donut")?.remove();
      app.mode = app.mode === "age" ? "disability" : "age"; app.focus = null; app.ageFilter = null;
      document.getElementById("toggleBtn").textContent = `show: ${app.mode === "age" ? "age-band" : "disability"}`;
      drawDonut(); updateLines(); updateDot(); updateStack();
    };

    /* Utility: Convert raw age band to a standard age bucket */
    function bucketAge(raw) {
      const [lo, hiRaw] = raw.replace("+", "").split(" to ").map(Number);
      const hi = hiRaw ?? 200;
      return hi <= 14 ? "0-14" : lo <= 24 ? "15-24" : lo <= 34 ? "25-34" : lo <= 54 ? "35-54" : "55+";
    }

    /* Main function to render the donut chart */
    function drawDonut() {
      if (!donutRows) return;
      const rows = donutRows.filter(r => (nameToCode[r.state] || r.state) === app.state); // Filter the dataset to match the currently selected state (via state code or name)
      // Prepare the data depending on mode
      const data = app.mode === "age"
        ? ageBuckets.map(k => ({ key: k, value: d3.sum(rows.filter(r => (r.age_bucket ?? bucketAge(r.age_band)) === k), r => r.participant_count) }))
        : Array.from(d3.rollup(rows, v => d3.sum(v, r => r.participant_count), r => r.disability), ([k, v]) => ({ key: k, value: v }))
          .sort((a, b) => d3.descending(a.value, b.value)).slice(0, 5); // Sort descending and take top 5 disabilities
      const svgDonut = d3.select("#donut").attr("viewBox", "0 0 380 380"), R = 160;
      const g = svgDonut.selectAll("g.core").data([null]).join("g").attr("class", "core").attr("transform", "translate(190,190)"); // Center the donut
      // Compute pie layout
      const pie = d3.pie().value(d => d.value).sort(null)(data);
      const arc = d3.arc().innerRadius(R * 0.45).outerRadius(R);  // Define arc generator for inner and outer radius
      const colour = app.mode === "age" ? ageColor : d3.scaleOrdinal(data.map(d => d.key), d3.schemeSet3);
      // Bind data and render donut slices
      const pathSel = g.selectAll("path").data(pie, d => d.data.key).join(
        enter => enter.append("path")
          .attr("stroke", "#000").attr("stroke-width", 1)
          .attr("fill", d => colour(d.data.key))
          .attr("cursor", "pointer")
          .on("click", (e, d) => {
            donutBounce = false; 
            document.getElementById("donutWrap").classList.remove("pulse"); 
            document.getElementById("tip-donut")?.remove(); // On slice click: remove pulse animation, remove tooltip if visible
            if (app.mode === "disability") { app.focus = app.focus === d.data.key ? null : d.data.key; updateLines(); }
            else { app.ageFilter = app.ageFilter === d.data.key ? null : d.data.key; updateDot(); updateStack(); }
            highlight();
          }))
        .attr("d", arc);
      // Highlight selected slice if any
      highlight();

      /* legend */
      const lg = d3.select("#legend").selectAll("div").data(data, d => d.key).join(
        enter => { const d = enter.append("div"); d.append("span").attr("class", "swatch"); d.append("span").attr("class", "lbl"); return d; });
      lg.select(".swatch").style("background", d => colour(d.key));
      lg.select(".lbl").text(d => `${d.key}: ${d3.format(",")(d.value)}`);
      /* Dynamic Chart Title */
      d3.select("#donutWrap h3").remove();
      d3.select("#donutWrap").insert("h3", "svg").style("margin", "0 0 4px").style("font-size", "13px")
        .html(`<strong>${app.state}</strong> - Participant share by ${app.mode === "age" ? "age" : "disability"}`);

      /*  Add bounce effect on initial load */
      if (donutBounce) document.getElementById("donutWrap").classList.add("pulse");
      function highlight() {
        pathSel.attr("stroke-width", d => {
          if (app.mode === "disability") return (app.focus === d.data.key ? 3 : 1);
          return (app.ageFilter === d.data.key ? 3 : 1);
        }).attr("fill-opacity", d => {
          if (app.mode === "disability") return app.focus ? (d.data.key === app.focus ? 1 : .25) : 1;
          return app.ageFilter ? (d.data.key === app.ageFilter ? 1 : .25) : 1;
        });
      }
    }

    /*  LINE CHART  */
    // Globals used across the chart
    let quarterDates = [], // Unique list of quarterly timestamps
     lineState = {}, topDisabilities = [];
    let lineMode = "top";   // "top" (=default)  or "all"
    let allDisabilities = [];      // filled once the CSV has loaded


   /* SVG sizing and layout setup */
    const lineSvg = d3.select("#lineChart"),
      lw = +lineSvg.attr("width"),
      lh = +lineSvg.attr("height"),
      lm = { top: 20, right: 150, bottom: 60, left: 60 },
      iw = lw - lm.left - lm.right,
      ih = lh - lm.top - lm.bottom,
      gLine = lineSvg.append("g")
        .attr("transform", `translate(${lm.left},${lm.top})`);

    /* load-draw */
    d3.csv("line_budget_disability.csv", d3.autoType).then(lines => {


      /* -------- slider setup -------- */

    // Extract all unique quarter values and sort chronologically
      quarterDates = [...new Set(lines.map(d => d.date_q))].sort(d3.ascending);

    // Configure the HTML slider control to match number of quarters
      const slider = document.getElementById("yearSlider");
      slider.max = quarterDates.length - 1;
      slider.value = slider.max;
    // Add labeled tick marks to the datalist (beneath the slider)
      document.getElementById("sliderMarks").innerHTML =
        quarterDates.map((d, i) =>
          `<option value="${i}" label="${fmtQuarter(d)}">`).join("");

      updateSliderLabel();

      /* -------- scales -------- */
      // Y-axis: budget values (linear scale, top-down)
      const y = d3.scaleLinear()
        .domain([0, d3.max(lines, d => d.avg_budget)]).nice()
        .range([ih, 0]);
      // X-axis: time (quarterly intervals, horizontal)
      const x = d3.scaleTime()
        .domain([quarterDates[0], quarterDates.at(-1)])
        .range([0, iw]);

      // Group all rows by disability type
      const nested = d3.group(lines, d => d.disability);
      const filtered = Array.from(nested).filter(([k]) => k !== "DsbltyGrp_Missing");  // Filter out the "missing" category
      // Compute top 5 disability types by total budget (sum across all quarters)
      topDisabilities = Array.from(filtered, ([k, v]) => [k, d3.sum(v, d => d.avg_budget)])
        .sort((a, b) => d3.descending(a[1], b[1]))
        .slice(0, 5)
        .map(d => d[0]);
      allDisabilities = [...nested.keys()].filter(k => k !== "DsbltyGrp_Missing");

      // Store all disability keys (excluding "missing")
      disColour.domain([...nested.keys()]);  // lock scale to every disability label
      /* ----------  COLOUR PALETTE  ---------- */
      disColour.range([
        "#1f77b4",  // vivid blue
        "#000000", //black
        "#d62728",  // strong red
        "#9D00FF",  // bright green
        "#9467bd",  // purple
        "#ff7f0e",  // orange
        "#17becf",  // cyan
        "#FFFF00", //yellow
        "#e377c2",  // pink
        "#dcbd89",  // yellow-green
        "#7f7f7f",  // neutral grey
        "#393b79",  // deep indigo
        "#8c564b",  // brown
        "#e7ba52",  // mustard
        "#637939",  // olive
        "#843c39",  // brick red
        "#31a354"   // emerald
      ]);
      // Buttons to toggle between top 5 and All 
      const btnTop = document.getElementById("btnTop"),
        btnAll = document.getElementById("btnAll");
      
      // When "Top 5" is clicked, set mode and refresh lines
      btnTop.onclick = () => {
        lineMode = "top";
        btnTop.classList.add("active"); btnAll.classList.remove("active");
        updateLines();
      };
      // When "All" is clicked, change mode and redraw lines
      btnAll.onclick = () => {
        lineMode = "all";
        btnAll.classList.add("active"); btnTop.classList.remove("active");
        updateLines();
      };
      // D3 line generator maps data points to (x, y) coordinates
      const line = d3.line()
        .x(d => x(d.date_q))
        .y(d => y(d.avg_budget));

      /* -------- axis setup -------- */
      // X-axis positioned at the bottom of the chart
      gLine.append("g")
        .attr("class", "xAxis")
        .attr("transform", `translate(0,${ih})`);
      // Y-axis on the left 
      gLine.append("g")               // y-axis
        .attr("class", "yAxis")
        .call(d3.axisLeft(y).tickFormat(d3.format("$.2s")));
      // Label for X-axis ("Quarter")
      gLine.append("text")
        .attr("class", "axisLabel")
        .attr("x", iw / 2)
        .attr("y", ih + lm.bottom - 4)
        .text("Quarter");
      // Label for Y-axis ("Budget (AUD)")
      gLine.append("text")
        .attr("class", "axisLabel")
        .attr("transform", "rotate(-90)")
        .attr("x", -ih / 2)
        .attr("y", -lm.left + 11)
        .text("Budget (AUD)");

      /* -------- series groups -------- */
      // For each disability group, append a <g> group that will contain its line path
      const series = gLine.selectAll(".series")
        .data(filtered)
        .enter()
        .append("g")
        .attr("class", "series");

      /* lines with hover highlight & tooltip */
      series.append("path")
        .attr("class", "trend")
        .attr("fill", "none")
        .attr("stroke-width", 2.5)
        .attr("stroke", ([k]) => disabilityColor(k))
        // --- Mouse hover interactions ---
        .on("mouseover", function () {
          d3.selectAll(".trend").classed("faded", true);
          d3.select(this).classed("faded", false);
          tooltip.style("opacity", 1);
        })
        .on("mousemove", function (event, [k, v]) {
          const [mx] = d3.pointer(event, gLine.node());
          const date = x.invert(mx);
          const nearest = v.reduce((a, b) =>
            Math.abs(b.date_q - date) < Math.abs(a.date_q - date) ? b : a);
          // Update tooltip content with nearest quarter's data
          tooltip.html(
            `<strong>${k}</strong><br>` +
            `${fmtQuarter(nearest.date_q)}<br>` +
            `Budget $${d3.format(",.0f")(nearest.avg_budget)}`)
            .style("left", (event.pageX + 12) + "px")
            .style("top", (event.pageY - 28) + "px");
        })
        .on("mouseout", () => {
          d3.selectAll(".trend").classed("faded", false);
          tooltip.style("opacity", 0);
        });

      /* container for dots */
      series.append("g").attr("class", "dots");

      /* legend holder */
      const legend = gLine.append("g")
        .attr("transform", `translate(${iw + 40},0)`);

      /* store state and first draw */
      lineState = { x, y, line, series, legend };
      updateLines();

      /* slider interaction */
      slider.oninput = () => {
        updateSliderLabel();
        updateLines();
        document.getElementById("tip-line")?.remove();
      };
    });

    /* -------- util helpers -------- */
    /* Slider label update helper */
    function updateSliderLabel() {
      const d = quarterDates[+yearSlider.value];
      document.getElementById("sliderLabel").textContent = fmtQuarter(d);
    }
    /* Line chart update based on state */
    function updateLines() {
      if (!lineState.series) return;

      const maxDate = quarterDates[+yearSlider.value],
        { x, y, line, series, legend } = lineState;

      x.domain([quarterDates[0], maxDate]);

      /* refreshed x-axis + angled ticks */
      gLine.select(".xAxis")
        .call(
          d3.axisBottom(x)
            .tickValues(quarterDates.filter(d => d <= maxDate))   // every quarter
            .tickFormat(fmtQuarterFull)
            .tickPadding(6)
            .tickSizeOuter(0)
        )
        .selectAll("text")
        .attr("transform", "rotate(0)")
        .attr("dy", ".9em")
        .attr("dx", "2.5em")
        .style("text-anchor", "end");

      /* update every series */
      series.each(function ([k, v]) {

        const data = v.filter(d => d.date_q <= maxDate)
          .sort((a, b) => a.date_q - b.date_q),
          keep = app.focus
            ? (k === app.focus)                       // donut slice focus
            : (lineMode === "top"
              ? topDisabilities.includes(k)       // Top-5
              : true);                            // or show every series
        // --- Update line path for this disability ---
        d3.select(this).select(".trend")
          .attr("display", keep ? null : "none")
          .attr("d", line(data));

        // --- Update data dots (hover anchors) ---
        const dots = d3.select(this).select(".dots")
          .selectAll("circle")
          .data(data, d => d.date_q);

        dots.join(
          enter => enter.append("circle")
            .attr("r", 4)
            .attr("fill", "#000"),
          update => update,
          exit => exit.remove()
        )
          .attr("display",
            app.focus ? (k === app.focus ? null : "none")
              : "none")
          .attr("cx", d => x(d.date_q))
          .attr("cy", d => y(d.avg_budget));  // Show dots only if this line is selected
      });

      /* legend */
      const keys = app.focus
        ? [app.focus]
        : (lineMode === "top" ? topDisabilities : allDisabilities);
      legend.selectAll("text.legendTitle")
        .data([null])
        .join("text")
        .attr("class", "legendTitle")
        .attr("x", 0)
        .attr("y", -10)
        .style("font-size", "12px")
        .style("font-weight", "bold")
        .text("Disability type");

      const lg = legend.selectAll("g").data(keys).join(
        enter => {
          const g = enter.append("g");
          g.append("rect").attr("width", 12).attr("height", 12);
          g.append("text").attr("x", 18).attr("y", 10).style("font-size", "11px");
          return g;
        })
        .attr("transform", (d, i) => `translate(0,${i * 18})`);

      lg.select("rect").attr("fill", d => disabilityColor(d));
      lg.select("text").text(d => d);
    }

    /* DOT & STACK*/
    let dotAll, stackReady = false;

    /* --- dot plot --- */
    // Select the SVG element for the dot plot and define dimensions
    const dotSvg = d3.select("#dotPlot"), dw = +dotSvg.attr("width"), dh = +dotSvg.attr("height"), dm = { top: 20, right: 160, bottom: 40, left: 60 },
      iwDot = dw - dm.left - dm.right, ihDot = dh - dm.top - dm.bottom, gDot = dotSvg.append("g").attr("transform", `translate(${dm.left},${dm.top})`);

    // Load data from CSV file 
    d3.csv("dot_age_region_budget.csv", d3.autoType).then(a => {
      dotAll = a;
      // --- DROPDOWN MENU SETUP ---
      // Extract unique state codes from dataset and sort alphabetically
      const states = [...new Set(a.map(r => r.statecd))].sort();
      const sel = document.getElementById("regionSelect");

      ["All", ...states].forEach(s => {
        const o = document.createElement("option");
        o.value = s;
        o.textContent = s;
        sel.appendChild(o);
      });
      sel.value = "All";
      // Add interactivity: when dropdown value changes
      sel.onchange = () => {
        if (sel.value !== "All") {  // keep current view if "All" selected
          app.state = sel.value;
        }            // update global state
        stateChanged();                    // refresh ALL charts (donut, dot, line, stack)
        document.getElementById("tip-dot")?.remove();
      };
      updateDot();    // Initial rendering of the dot plot
    });

    function updateDot() {
      if (!dotAll) return; // If no data loaded, exit early
      // Filter data based on selected state
      let data = (document.getElementById("regionSelect").value === "All")
        ? dotAll                           // show all rows
        : dotAll.filter(r => r.statecd === app.state);

      // If an age group is selected via donut filter, further filter the data
      if (app.ageFilter) data = data.filter(r => r.age_bucket === app.ageFilter);
      const x = d3.scaleBand().domain(ageBuckets).range([0, iwDot]).padding(0.35);
      const y = d3.scaleLinear().domain([0, d3.max(data, r => r.avg_budget)]).nice().range([ihDot, 0]);
      gDot.selectAll("*").remove();

      // --- X Axis ---
      gDot.append("g")
        .attr("class", "xAxis")                         // add class
        .attr("transform", `translate(0,${ihDot})`)
        .call(d3.axisBottom(x));
      // --- Y Axis ---
      gDot.append("g")
        .attr("class", "yAxis")                         // add class
        .call(d3.axisLeft(y).tickFormat(d3.format("$.2s")));
      gDot.append("text").attr("class", "axisLabel").attr("x", iwDot / 2).attr("y", ihDot + dm.bottom - 4).text("Age group");
      gDot.append("text").attr("class", "axisLabel").attr("transform", "rotate(-90)").attr("x", -ihDot / 2).attr("y", -dm.left + 10).text("Budget (AUD)");

      // --- Dot Plot Circles ---
      gDot.selectAll("circle").data(data).enter().append("circle")
        .attr("cx", d => x(d.age_bucket) + x.bandwidth() / 2).attr("cy", d => y(d.avg_budget))
        .attr("r", 6).attr("fill", d => regionColor(d.region))

        // Tooltip on hover
        .on("mouseover", (e, d) => {
          tooltip
            .html(`<strong>${d.region}</strong><br>${d.age_bucket}<br>Budget $${d3.format(",.0f")(d.avg_budget)}`)
            .style("left", (e.pageX + 12) + "px")
            .style("top", (e.pageY - 28) + "px")
            .style("opacity", 1);
        })
        .on("mousemove", e => tooltip
          .style("left", (e.pageX + 12) + "px")
          .style("top", (e.pageY - 28) + "px"))
        .on("mouseout", () => tooltip.style("opacity", 0));

      // Update the title above the dot plot to reflect the selected state
      document.getElementById("dotTitle").textContent = app.state;
      const regs = [...new Set(data.map(r => r.region))];
      //Legend title
      dotSvg.selectAll("text.dotLegTitle").data([null]).join("text")
        .attr("class", "dotLegTitle")
        .attr("x", dw - dm.right + 20)
        .attr("y", dm.top - 10)
        .text("Regions")
        .style("font-weight", "bold")
        .style("font-size", "12px");
      // --- Legend Items ---
      const leg = dotSvg.selectAll("g.dotLeg").data(regs, r => r); leg.exit().remove();
      const e = leg.enter().append("g").attr("class", "dotLeg"); e.append("rect").attr("width", 12).attr("height", 12);
      e.append("text").attr("x", 18).attr("y", 10).style("font-size", "11px");
      e.merge(leg).attr("transform", (r, i) => `translate(${dw - dm.right + 20},${dm.top + i * 18})`).select("rect").attr("fill", r => regionColor(r));
      e.merge(leg).select("text").text(r => r);
    }
    /* stacked / grouped age budget chart */
    const stSvg = d3.select("#stackChart"),
      sw = +stSvg.attr("width"),
      sh = +stSvg.attr("height"),
      sm = { top: 20, right: 160, bottom: 40, left: 60 },
      iwSt = sw - sm.left - sm.right,
      ihSt = sh - sm.top - sm.bottom,
      gSt = stSvg.append("g")
        .attr("transform", `translate(${sm.left},${sm.top})`);

    let stackData = [],      // tidy rows for every quarter
      yScale,              // shared so we can reuse inside toggle
      xOuter, xInner,      // outer (= quarter) & inner (= age bucket) scales
      chartMode = "stacked";   // current view
    const btn = document.getElementById("stackToggle");

    /* data & first draw */
    d3.csv("stacked_age_budget_quarter.csv", d3.autoType).then(raw => {
      const wide = d3.rollup(
        raw,
        v => {
          const byAge = d3.rollup(
            v,
            vv => d3.mean(vv, d => d.avg_budget),
            d => d.age_bucket
          );
          return Object.fromEntries(ageBuckets.map(a => [a, byAge.get(a) || 0]));
        },
        d => d.date_q
      );

      stackData = [...wide].map(([k, v]) => ({ date_q: k, ...v }));

      draw();                        // initial stacked view
      stackReady = true;

      /* toggle button */
      btn.onclick = () => {
        chartMode = (chartMode === "stacked" ? "grouped" : "stacked");
        btn.textContent = `view: ${chartMode}`;
        draw();
      };
    });
    /* draws the stacked/grouped bar chart for budget trends across age groups */
    function draw() {

      gSt.selectAll("*").remove();           // clear the plot area

      /* shared scales */
      xOuter = d3.scaleBand()
        .domain(stackData.map(d => d.date_q))
        .range([0, iwSt])
        .padding(chartMode === "stacked" ? 0.15 : 0.25);
      // If grouped, define inner scale for age group bars inside each quarter
      if (chartMode === "grouped") {
        xInner = d3.scaleBand()
          .domain(ageBuckets)
          .range([0, xOuter.bandwidth()])
          .padding(0.08);
      }
       // Compute max value for y-axis: sum for stacked, max for grouped
      const yMax = chartMode === "stacked"
        ? d3.max(stackData, d =>
          d3.sum(ageBuckets, a => d[a]))
        : d3.max(stackData, d =>
          d3.max(ageBuckets, a => d[a]));

      yScale = d3.scaleLinear()
        .domain([0, yMax]).nice()
        .range([ihSt, 0]);

      /* axis setup  */
      /* X-axis and y-axis */
      gSt.append("g")
        .attr("class", "xAxis")
        .attr("transform", `translate(0,${ihSt})`)
        .call(d3.axisBottom(xOuter)
          .tickFormat(d => `Q${Math.floor(d.getMonth() / 3) + 1}-${d.getFullYear()}`));

      gSt.append("g")
        .attr("class", "yAxis")
        .call(d3.axisLeft(yScale).tickFormat(d3.format("$.2s")));
        
      /* Axis Labels */
      gSt.append("text").attr("class", "axisLabel")
        .attr("x", iwSt / 2).attr("y", ihSt + sm.bottom - 4)
        .text("Quarter");

      gSt.append("text").attr("class", "axisLabel")
        .attr("transform", "rotate(-90)")
        .attr("x", -ihSt / 2).attr("y", -sm.left + 10)
        .text("Budget (AUD)");

      /* bars */
       // Compute stack layout: each layer is one age group
      if (chartMode === "stacked") {

        const series = d3.stack().keys(ageBuckets)(stackData);

        gSt.selectAll(".layer")
          .data(series) // Each group (ageBucket) across quarters
          .enter().append("g")
          .attr("class", "layer")
          .attr("fill", l => ageColor(l.key)) // Color by age group
          .selectAll("rect")
          .data(d => d)
          .enter().append("rect")
          .attr("x", d => xOuter(d.data.date_q))
          .attr("y", d => yScale(d[1]))
          .attr("height", d => yScale(d[0]) - yScale(d[1]))
          .attr("width", xOuter.bandwidth())
          .call(addTooltip); // Add interactivity

      } else {   // Grouped layout: each age bar sits side-by-side within each quarter

        gSt.selectAll(".gQuarter")
          .data(stackData)
          .enter().append("g")
          .attr("class", "gQuarter")
          .attr("transform", d => `translate(${xOuter(d.date_q)},0)`)  // Position by quarter
          .selectAll("rect")
          .data(d => ageBuckets.map(a => ({ age: a, val: d[a], date_q: d.date_q })))
          .enter().append("rect")
          .attr("x", d => xInner(d.age))   // Position by age bucket within quarter
          .attr("y", d => yScale(d.val))
          .attr("height", d => ihSt - yScale(d.val))
          .attr("width", xInner.bandwidth())
          .attr("fill", d => ageColor(d.age))
          .call(addTooltip); // Tooltips
      }
      /* Legend */
      const legend = stSvg.selectAll("g.ageLegend")
        .data([null])                 // keep a single legend
        .join("g")
        .attr("class", "ageLegend")
        .attr("transform",
          `translate(${sw - sm.right + 20},${sm.top + 40})`);
      // Legend title
      legend.selectAll("text.legendTitle").data([null]).join("text")
        .attr("class", "legendTitle")
        .attr("x", 0)
        .attr("y", -10)
        .text("Age group")
        .style("font-weight", "bold")
        .style("font-size", "12px");

      const lg = legend.selectAll("g")
        .data(ageBuckets)               // the five age buckets
        .join(enter => {                // create if first time
          const g = enter.append("g");
          g.append("rect").attr("width", 12).attr("height", 12);
          g.append("text").attr("x", 18).attr("y", 10)
            .style("font-size", "11px");
          return g;
        });

      lg.attr("transform", (d, i) => `translate(0,${i * 18})`);
      lg.select("rect").attr("fill", d => ageColor(d));
      lg.select("text").text(d => d);
    }

    /* simple tooltip helper  */
    function addTooltip(sel) {
      sel.on("mouseover", (e, d) => {
        const age = d.age || d3.select(e.currentTarget.parentNode).datum().key;
        const value = ('val' in d) ? d.val : (d[1] - d[0]);
        tooltip.html(
          `<strong>${age}</strong><br>` +
          `${fmtQuarter(d.date_q || d.data.date_q)}<br>` +
          `Budget $${d3.format(",.0f")(value)}`
        )
          .style("left", (e.pageX + 12) + "px")
          .style("top", (e.pageY - 28) + "px")
          .style("opacity", 1);
      })
        .on("mousemove", e => tooltip
          .style("left", (e.pageX + 12) + "px")
          .style("top", (e.pageY - 28) + "px"))
        .on("mouseout", () => tooltip.style("opacity", 0));
    }

    /* keep highlight logic from donut, stack */
    function updateStack() {
      if (!stackReady) return;

      if (chartMode === "stacked") {
        // Highlight logic for stacked mode 
        stSvg.selectAll(".layer")
          .attr("fill-opacity", l =>
            app.ageFilter ? (l.key === app.ageFilter ? 1 : .25) : 1);
      } else {
        // Highlight logic for grouped mode
        stSvg.selectAll(".gQuarter").selectAll("rect")
          .attr("fill-opacity", d =>
            app.ageFilter ? (d.age === app.ageFilter ? 1 : .25) : 1);
      }
    }

    /* State sync */
    function stateChanged() {
      document.getElementById("stateSelect").value = app.state;
      drawDonut(); updateDot(); updateLines(); updateStack();
    }
    // MODAL LOGIC: hide on close or "Get started"
    document.querySelector('.storyModal-close').onclick =
      document.getElementById('storyModal-ok').onclick = function () {
        document.getElementById('storyModal').classList.add('hide');
        setTimeout(() => { document.getElementById('storyModal').style.display = 'none'; }, 350);
      };
  </script>

  <!-- References -->
  <footer
    style="text-align:center; font-size:13px; margin-top:60px; padding:20px 10px; color:#555; border-top:1px solid #ccc;">
    <p><strong>References</strong></p>
    <ul style="list-style: none; padding: 0; margin: 0 auto; max-width: 600px; text-align:left;">
      <li>[1] Participant datasets | NDIS, <em>NDIS Data Research</em>,
        https://dataresearch.ndis.gov.au/datasets/participant-datasets</li>
      <li>[2] D3.js - Data-Driven Documents, <em>d3js.org</em>, https://d3js.org/</li>
    </ul>
  </footer>
</body>

</html>